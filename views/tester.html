<!DOCTYPE html>
<html>
<head>
  <title>API Tester</title>
  <style>
    body { font-family: Arial; padding: 20px; max-width: 800px; margin: auto; }
    input, button { padding: 5px; margin: 5px; }
    .section { border: 1px solid #ccc; padding: 15px; margin-bottom: 20px; }
    .token { width: 100%; }
  </style>
</head>
<body>

<h1>Node.js API Tester</h1>

<div class="section">
  <h2>Register</h2>
  <input id="regUsername" placeholder="Username">
  <input id="regPassword" type="password" placeholder="Password">
  <button onclick="register()">Register</button>
  <div id="regResult"></div>
</div>

<div class="section">
  <h2>Login</h2>
  <input id="loginUsername" placeholder="Username">
  <input id="loginPassword" type="password" placeholder="Password">
  <button onclick="login()">Login</button>
  <div>Token:</div>
  <input id="token" class="token" readonly>
</div>

<div class="section">
  <h2>Create Item</h2>
  <input id="itemName" placeholder="Item Name">
  <button onclick="createItem()">Create</button>
</div>

<div class="section">
  <h2>List Items</h2>
  <button onclick="listItems()">Fetch Items</button>
  <pre id="itemsList"></pre>
</div>

<div class="section">
  <h2>Update Item</h2>
  <input id="updateId" placeholder="Item ID">
  <input id="updateName" placeholder="New Name">
  <button onclick="updateItem()">Update</button>
</div>

<div class="section">
  <h2>Delete Item</h2>
  <input id="deleteId" placeholder="Item ID">
  <button onclick="deleteItem()">Delete</button>
</div>

<script>
let API_URL = 'http://localhost:36535';
let jwtToken = '';

async function register() {
  const username = document.getElementById('regUsername').value;
  const password = document.getElementById('regPassword').value;
  const res = await fetch(`${API_URL}/register`, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ username, password })
  });
  const text = await res.text();
  document.getElementById('regResult').innerText = text;
}

async function login() {
  const username = document.getElementById('loginUsername').value;
  const password = document.getElementById('loginPassword').value;
  const res = await fetch(`${API_URL}/login`, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ username, password })
  });
  const text = await res.text();
  // Extract token from input box returned by your Node.js login
  const match = text.match(/value="([^"]+)"/);
  if (match) {
    jwtToken = match[1];
    document.getElementById('token').value = jwtToken;
  }
  alert(text);
}

async function createItem() {
  const name = document.getElementById('itemName').value;
  const res = await fetch(`${API_URL}/items`, {
    method: 'POST',
    headers: { 
      'Content-Type': 'application/json',
      'Authorization': 'Bearer ' + jwtToken
    },
    body: JSON.stringify({ name })
  });
  const text = await res.text();
  alert(text);
}

async function listItems() {
  const res = await fetch(`${API_URL}/items/list`, {
    headers: { 'Authorization': 'Bearer ' + jwtToken }
  });
  const data = await res.json();
  document.getElementById('itemsList').innerText = JSON.stringify(data, null, 2);
}

async function updateItem() {
  const id = document.getElementById('updateId').value;
  const name = document.getElementById('updateName').value;
  const res = await fetch(`${API_URL}/items/update`, {
    method: 'POST',
    headers: { 
      'Content-Type': 'application/json',
      'Authorization': 'Bearer ' + jwtToken
    },
    body: JSON.stringify({ id, name })
  });
  const text = await res.text();
  alert(text);
}

async function deleteItem() {
  const id = document.getElementById('deleteId').value;
  const res = await fetch(`${API_URL}/items/delete`, {
    method: 'POST',
    headers: { 
      'Content-Type': 'application/json',
      'Authorization': 'Bearer ' + jwtToken
    },
    body: JSON.stringify({ id })
  });
  const text = await res.text();
  alert(text);
}
</script>

</body>
</html>
